### 				MongoDB安全认证

#### 1开启用户验证

​	mongodb 默认启动不加任何参数时，是没有身份认证的，任何人都可以登录进行任何操作。

​	启动时添加--auth参数开启身份验证模式(或在配置文件中auth=ture，强制不使用身份验证则添加--noauth)——当设置为true时候，进入数据库需要auth验证，当数据库里没有用户，则不需要验证也可以操作。直到创建了第一个用户，之后操作都需要验证。

#### 2用户验证与访问控制

##### 2.1用户验证

​	db.auth("root","root")。

##### 2.2访问控制

​	创建用户并设置访问权限

```mongodb
use admin #只有在admin上才能创建权限用户，用于管理所有数据库管限的用户。
db.createUser({user:"root",pwd:"root",roles:			          					[{role:"root",db:"admin"}]})  #创建root用户
```

​	user:唯一的用户名   		pwd:密码

​	roles:用户的角色数组，mongodb提供了大量可分配的角色。

​	authenticationRestrictions:服务器在创建用户上强制执行的身份验证限制。指定可连接服务器的访问用户的ip地址列表或指定可连接服务器的服务器ip地址列表。（即白名单验证）。

| authenticationRestrictions参数 |                             描述                             |
| :----------------------------: | :----------------------------------------------------------: |
|          clientSource          | 如果存在，则服务器验证客户端的ip地址是否位于给定列表中，或者属于列表中的一个CIDR范围。如果客户端的ip地址不在当前，服务器就不会对用户进行身份验证。 |
|         serverAddress          | 客户端可以连接的ip地址列表或CIDR范围。如果存在，服务器将验证客户端的连接是否符合给定列表中的ip地址列表或CIDR。如果不符合，则服务器不会对用户进行身份验证 |

​	常用的权限roles:

​	root：即root权限，可以管理所有的数据库及用户，拥有所有角色的所有权限。只能创建在admin上。

​	![1552628742026](C:\Users\dqk\Documents\1552628742026.png)

​	一旦执行过一次createUser，只能通过验证后才能进行创建操作

​	删除用户：db.dropUser()

​	创建普通用户

```mongodb
use test		#切换数据库
db.createUser({user: "dqk", pwd: "duqinkai", roles: 
				[{role:"dbOwner", db: "test" }]}) 	#创建用户
```

​	修改用户账号

![1552629097995](C:\Users\dqk\Documents\1552629097995.png)

##### 2.3复制与分片中的访问控制

​	复制集中以密钥文件进行访问控制。

​	（1）创建密钥文件

​	使用密钥文件身份验证，副本集中的每个mongod实例使用密钥文件的内容作为共享密码，用于验证部署中的其他成员。

​	（2）将密钥文件复制到每一个副本集

​	将密钥文件复制到副本集成员的每一个服务器。

​	（3）关闭副本集

​	（4）启动时加keyfile参数强制开启内部身份验证。



#### 3其他安全设置

​	（1）mongod 参数 ： --bind_ip （内网访问）

​	默认所有IP地址都能访问，加上此参数可以指定mongdb对外提供服务的IP地址，客户端只能使用绑定的IP地址才能连接mongdb。

​	（2）设置端口： --port

​	默认端口为27017。

​	 （3）审计（商业版）

​	（4）备份